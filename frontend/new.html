<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Optional JavaScript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">

  <script src="script.js"></script>

  <link href="css/styles.css" rel="stylesheet" />
  <script>
    
    // $(document).ready(function() {
    //   $('.js-example-basic-single').select2();
    // });
    function getCookie(cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for(var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
          c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
          }
      }
      return "";
    }
    window.addEventListener("load", function () {

      var cat = getCookie("category");
      var configUrl = "https://whiteleaf-resources.s3.us-east-2.amazonaws.com/form-config/" + cat + ".json";
      alert("Selected category in the previous page is " + cat);
      reqForm = cat + "Form";

      var parentRow = document.getElementById("parentRow");

      var formCol = document.createElement("div");
      formCol.classList.add("col-7");

      var newFrom = document.createElement("FORM");
      newFrom.setAttribute("id", reqForm);
      newFrom.classList.add("container-fluid");
      formCol.appendChild(newFrom);

      $.ajax({
        url:configUrl,
        type:"GET",
        dataType: "json",
        async: false,
        success:function(data) {
            j= data;
        }
      });

      // var j = JSON.parse(JSON.stringify(jsonConfig));
      for(var p in j){
        console.log(j[p]);

        var rowDiv = document.createElement("div");
        rowDiv.classList.add("row");

        var col4Div = document.createElement("div");
        col4Div.classList.add("col-3");
        // col4Div.style.textAlign = "center";
        var newLabel = document.createElement("label");
        newLabel.innerHTML = j[p].label;
        newLabel.style.verticalAlign = "middle";
        newLabel.style.margin = "auto";
        newLabel.setAttribute("for", j[p].id);
        col4Div.appendChild(newLabel);

        var col8Div = document.createElement("div");
        col8Div.classList.add("col-9");

        if(j[p].type == "select"){
          var newInput = document.createElement("select");
        }else{
          var newInput = document.createElement("input");
          newInput.setAttribute("type", j[p].type);
          newInput.classList.add("form-control");
        }

        if(j[p].type == "select"){
          if(j[p].server_loaded != null){

            newInput.classList.add("js-example-basic-single");
            var XHROb = new XMLHttpRequest();
            XHROb.open("GET", "http://3.128.23.111:5000/api/v1/list/subcat");
                // Set request header to get a json repsonse
            XHROb.setRequestHeader('Content-type', 'application/json');
            XHROb.send();              
            XHROb.onreadystatechange = function(){
              if (this.readyState == 4 && this.status == 200) {
                var response = JSON.parse(this.responseText);
                console.log(response);
                var subCategories = response[cat.replace(/_/g, " ").toUpperCase()];
                // console.log(subCategories);
                for(subcat in subCategories){
                  console.log(subCategories[subcat]);
                  var newOption = document.createElement("option");
                  var op = new Option();
                  op.value =subCategories[subcat];
                  op.text = subCategories[subcat];
                  newOption.append(op);
                  var subSelect = document.getElementById("sub_category");
                  // newInput.append(newOption);
                  subSelect.appendChild(newOption);
                  // document.body.appendChild(newOption);
                }
                $('.js-example-basic-single').select2();
              }
            }
          }
          else{
            var selectOptions = j[p].option;
            for (const ele in selectOptions) {
              if (selectOptions.hasOwnProperty(ele)) {
                const element = selectOptions[ele];
                for(jkl in element){
                  // console.log(jkl,element[jkl]);
                  var newOption = document.createElement("option");
                  var op = new Option();
                  op.value = element[jkl];
                  op.text = jkl;
                  newOption.append(op);
                  newInput.appendChild(newOption);
                }
              }
            }
          }
        }
        
        newInput.setAttribute("id", j[p].id);
        newInput.setAttribute("placeholder", j[p].placeholder);
        newInput.setAttribute("name", j[p].name);
        
        if(j[p].required != null){
          newInput.required = true;
        }

        if(j[p].style != null){
          
        }        
        col4Div.appendChild(newLabel);
        col8Div.appendChild(newInput);
        rowDiv.appendChild(col4Div);
        rowDiv.appendChild(col8Div);
        
        newFrom.appendChild(rowDiv);
        
      }
      var submitButton = document.createElement("button");
      submitButton.setAttribute("type","submit");
      submitButton.setAttribute("type","button");
      submitButton.setAttribute("onclick","ajax_file_upload()");
      submitButton.innerHTML = "Submit";
      submitButton.classList.add("btn");
      submitButton.classList.add("btn-primary");
      submitButton.style.margin = "20px";
      submitButton.style.alignSelf = "center";
      newFrom.appendChild(submitButton);
      var beforeDiv = document.getElementById("image_upload_div");
      parentRow.insertBefore(formCol, beforeDiv);
    });

  </script>
<title>Home Page</title>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
      aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="home_page.html">HOME</a>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item ">
          <a class="nav-link" href="category.html">NEW<span class="sr-only"></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="edit_roductcategory.html" id="edit">EDIT/DELETE</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="category.html">REPORTS<span class="sr-only"></a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container-fluid" id="parentDiv">
  <h4 style="margin-left: 10px;">Enter Product Details</h4>
  <div class="row" id="parentRow">
    <div class="col-3" id="image_upload_div">  
      <div id="drop_file_zone" ondrop="upload_file(event)" ondragover="return false">
        <div id="drag_upload_file">
          <p>Drop file here</p>
          <p>or</p>
          <p><input type="button" class="btn btn-primary" value="Select File" onclick="file_explorer();"></p>
          <input type="file" id="selectfile" multiple>
        </div>
      </div>
    </div>

    <div class="col-2">
      <div id="show_uploaded_images" style="text-align: center; display: none;">
        <p style="align-self: center;">Selected Images</p>
        <div id="image_list_div" class="all-slides">
        </div>
      </div>
    </div>
  </div>
</div>

</body>

</html>